---
layout:     post
title:      数据逻辑删除
subtitle:   关于逻辑删除需要注意的问题
date:       2022-12-26
author:     W
header-img: img/post-bg-cook.jpg
catalog: true
tags:
    - 数据库
    - 逻辑删除
---

## 前言

作为一名后端开发者，平时对业务操作最多的应该就是CRUD，其中物理删除操作在业务中基本不会使用，而是使用逻辑删除进行代替，因为数据无价，所有的数据都需要保留，在遇到BUG时方便定位排查，解决问题、回滚数据。



## 正文

`is_deleted `，大多数时候，我们都使用一个 boolean 字段进行标识是否逻辑删除，默认为 false，删除时该为 true ，查询时有效数据为 false 。

当对象需要做一些唯一性校验时，此方法会存在一些不足。

```
例1：
使用手机号进行注册时，需要建立手机号字段与标识字段联合唯一的索引限制，如果已经使用某一手机号进行注册且标记为删除，再次使用该手机号可注册成功，删除时会抛出唯一键异常！
```

`delete_date`，使用 date 字段进行标识是否逻辑删除，默认为 null ，删除时添加当前时间，查询时有效数据为 null 。

当对象需要做一些唯一性校验时，此方法会存在一些不足。

```
例2：
使用手机号进行注册时，需要建立手机号字段与标识字段联合唯一的索引限制，如果已经使用某一手机号进行注册且标记为删除，再次使用该手机号可注册成功，也可正常删除。但是联合索引中存在 null 时，索引失效，同一手机号可无限新增数据！
```

`delete_time`，使用 timestamp 字段进行标识是否逻辑删除，默认为 0 ，删除时添加当前时间戳，查询时有效数据为 0 。

```
例3：
使用手机号进行注册时，需要建立手机号字段与标识字段联合唯一的索引限制，如果已经使用某一手机号进行注册且标记为删除，再次使用该手机号可注册成功，也可正常删除。同一手机号有且仅有一条有效数据！
```

